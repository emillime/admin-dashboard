import{s as ge,r as Ve,n as oe,o as Fe,i as je,b as pe,h as Se}from"../chunks/scheduler.a70eca57.js";import{S as _e,i as ve,g as k,m as P,s as N,r as ae,h as w,j as S,n as j,f as p,c as O,u as se,x as re,k as I,a as R,y as n,v as ne,A as me,o as U,d as K,t as X,w as ie,B as he,e as Ne,b as Ue,z as Oe,p as We}from"../chunks/index.fec47d3a.js";import{a as ze,l as Ge}from"../chunks/localDb.52dd18f1.js";import{p as Ye,f as Ke}from"../chunks/utils.a31f8b5c.js";import{e as te}from"../chunks/each.13dd49ab.js";import{D as V,g as Qe,a as Xe}from"../chunks/api.04474085.js";import{e as $e,g as Ze}from"../chunks/index.d3a98df3.js";import{F as be}from"../chunks/fa.28829ef6.js";import{g as qe}from"../chunks/jwtUtils.fbb3dbd8.js";import{_ as He}from"../chunks/preload-helper.41c905a7.js";function Be(o,t,l){const e=o.slice();return e[7]=t[l],e}function Me(o,t,l){const e=o.slice();return e[10]=t[l],e}function Ce(o,t,l){const e=o.slice();return e[13]=t[l],e}function Le(o){let t,l,e,r="",u,m,h="",s,d,v="",i,c,x,H="Totalt:",L,g,M,B=te(o[1]),_=[];for(let f=0;f<B.length;f+=1)_[f]=Ae(Me(o,B,f));let C=te(Object.keys(o[3])),T=[];for(let f=0;f<C.length;f+=1)T[f]=Je(Be(o,C,f));return{c(){for(let f=0;f<_.length;f+=1)_[f].c();t=N(),l=k("tr"),e=k("td"),e.innerHTML=r,u=N(),m=k("td"),m.innerHTML=h,s=N(),d=k("td"),d.innerHTML=v,i=N(),c=k("td"),x=k("span"),x.textContent=H,L=N(),g=k("br"),M=N();for(let f=0;f<T.length;f+=1)T[f].c();this.h()},l(f){for(let b=0;b<_.length;b+=1)_[b].l(f);t=O(f),l=w(f,"TR",{});var D=S(l);e=w(D,"TD",{class:!0,["data-svelte-h"]:!0}),re(e)!=="svelte-htvrbq"&&(e.innerHTML=r),u=O(D),m=w(D,"TD",{class:!0,["data-svelte-h"]:!0}),re(m)!=="svelte-15o35c4"&&(m.innerHTML=h),s=O(D),d=w(D,"TD",{class:!0,["data-svelte-h"]:!0}),re(d)!=="svelte-1p8by23"&&(d.innerHTML=v),i=O(D),c=w(D,"TD",{class:!0});var a=S(c);x=w(a,"SPAN",{class:!0,["data-svelte-h"]:!0}),re(x)!=="svelte-16ak52n"&&(x.textContent=H),L=O(a),g=w(a,"BR",{}),M=O(a);for(let b=0;b<T.length;b+=1)T[b].l(a);a.forEach(p),D.forEach(p),this.h()},h(){I(e,"class","border-t-0 px-6 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4 text-left"),I(m,"class","border-t-0 px-6 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4 text-left"),I(d,"class","border-t-0 px-6 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4"),I(x,"class","font-bold text-slate-600"),I(c,"class","border-t-0 px-6 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap text-left")},m(f,D){for(let a=0;a<_.length;a+=1)_[a]&&_[a].m(f,D);R(f,t,D),R(f,l,D),n(l,e),n(l,u),n(l,m),n(l,s),n(l,d),n(l,i),n(l,c),n(c,x),n(c,L),n(c,g),n(c,M);for(let a=0;a<T.length;a+=1)T[a]&&T[a].m(c,null)},p(f,D){if(D&2){B=te(f[1]);let a;for(a=0;a<B.length;a+=1){const b=Me(f,B,a);_[a]?_[a].p(b,D):(_[a]=Ae(b),_[a].c(),_[a].m(t.parentNode,t))}for(;a<_.length;a+=1)_[a].d(1);_.length=B.length}if(D&8){C=te(Object.keys(f[3]));let a;for(a=0;a<C.length;a+=1){const b=Be(f,C,a);T[a]?T[a].p(b,D):(T[a]=Je(b),T[a].c(),T[a].m(c,null))}for(;a<T.length;a+=1)T[a].d(1);T.length=C.length}},d(f){f&&(p(t),p(l)),he(_,f),he(T,f)}}}function Re(o){let t=o[13].quantity+"",l,e,r=o[13].productName+"",u,m,h;return{c(){l=P(t),e=N(),u=P(r),m=N(),h=k("br")},l(s){l=j(s,t),e=O(s),u=j(s,r),m=O(s),h=w(s,"BR",{})},m(s,d){R(s,l,d),R(s,e,d),R(s,u,d),R(s,m,d),R(s,h,d)},p(s,d){d&2&&t!==(t=s[13].quantity+"")&&U(l,t),d&2&&r!==(r=s[13].productName+"")&&U(u,r)},d(s){s&&(p(l),p(e),p(u),p(m),p(h))}}}function Ae(o){let t,l,e,r=`${V.fromJSDate(o[10].startTime).toFormat("HH:mm")} - ${V.fromJSDate(o[10].endTime).toFormat("HH:mm")}`,u,m,h,s,d=o[10].bookingId.customerInfo.firstName+"",v,i,c=o[10].bookingId.customerInfo.lastName+"",x,H,L,g,M,B=o[10].bookingId.customerInfo.mobile+"",_,C,T,f,D=te(Object.values(o[10].bookingId.priceObject.products)),a=[];for(let b=0;b<D.length;b+=1)a[b]=Re(Ce(o,D,b));return{c(){t=k("tr"),l=k("td"),e=k("span"),u=P(r),m=N(),h=k("td"),s=k("span"),v=P(d),i=N(),x=P(c),H=N(),L=k("td"),g=k("a"),M=P("+"),_=P(B),T=N(),f=k("td");for(let b=0;b<a.length;b+=1)a[b].c();this.h()},l(b){t=w(b,"TR",{});var E=S(t);l=w(E,"TD",{class:!0});var y=S(l);e=w(y,"SPAN",{class:!0});var z=S(e);u=j(z,r),z.forEach(p),y.forEach(p),m=O(E),h=w(E,"TD",{class:!0});var G=S(h);s=w(G,"SPAN",{class:!0});var q=S(s);v=j(q,d),i=O(q),x=j(q,c),q.forEach(p),G.forEach(p),H=O(E),L=w(E,"TD",{class:!0});var Y=S(L);g=w(Y,"A",{href:!0});var Z=S(g);M=j(Z,"+"),_=j(Z,B),Z.forEach(p),Y.forEach(p),T=O(E),f=w(E,"TD",{class:!0});var ee=S(f);for(let W=0;W<a.length;W+=1)a[W].l(ee);ee.forEach(p),E.forEach(p),this.h()},h(){I(e,"class","text-slate-600"),I(l,"class","border-t-0 px-6 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4 text-left"),I(s,"class","font-bold text-slate-600"),I(h,"class","border-t-0 px-6 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4 text-left"),I(g,"href",C="tel:+"+o[10].bookingId.customerInfo.mobile),I(L,"class","border-t-0 px-6 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4"),I(f,"class","border-t-0 px-6 align-middle border-l-0 border-r-0 text-xs whitespace-nowrap p-4 text-left")},m(b,E){R(b,t,E),n(t,l),n(l,e),n(e,u),n(t,m),n(t,h),n(h,s),n(s,v),n(s,i),n(s,x),n(t,H),n(t,L),n(L,g),n(g,M),n(g,_),n(t,T),n(t,f);for(let y=0;y<a.length;y+=1)a[y]&&a[y].m(f,null)},p(b,E){if(E&2&&r!==(r=`${V.fromJSDate(b[10].startTime).toFormat("HH:mm")} - ${V.fromJSDate(b[10].endTime).toFormat("HH:mm")}`)&&U(u,r),E&2&&d!==(d=b[10].bookingId.customerInfo.firstName+"")&&U(v,d),E&2&&c!==(c=b[10].bookingId.customerInfo.lastName+"")&&U(x,c),E&2&&B!==(B=b[10].bookingId.customerInfo.mobile+"")&&U(_,B),E&2&&C!==(C="tel:+"+b[10].bookingId.customerInfo.mobile)&&I(g,"href",C),E&2){D=te(Object.values(b[10].bookingId.priceObject.products));let y;for(y=0;y<D.length;y+=1){const z=Ce(b,D,y);a[y]?a[y].p(z,E):(a[y]=Re(z),a[y].c(),a[y].m(f,null))}for(;y<a.length;y+=1)a[y].d(1);a.length=D.length}},d(b){b&&p(t),he(a,b)}}}function Je(o){let t=o[3][o[7]]+"",l,e,r=o[7]+"",u,m,h;return{c(){l=P(t),e=N(),u=P(r),m=N(),h=k("br")},l(s){l=j(s,t),e=O(s),u=j(s,r),m=O(s),h=w(s,"BR",{})},m(s,d){R(s,l,d),R(s,e,d),R(s,u,d),R(s,m,d),R(s,h,d)},p(s,d){d&8&&t!==(t=s[3][s[7]]+"")&&U(l,t),d&8&&r!==(r=s[7]+"")&&U(u,r)},d(s){s&&(p(l),p(e),p(u),p(m),p(h))}}}function et(o){var we;let t,l,e,r,u,m=((we=o[1])==null?void 0:we.length)+"",h,s,d,v,i,c,x,H=`${V.fromJSDate(o[0]).toRelativeCalendar()}`,L,g,M,B=o[0].toLocaleDateString()+"",_,C,T,f,D,a,b,E,y,z,G,q,Y,Z='<tr><th class="px-6 align-middle border border-solid py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left bg-slate-50 text-slate-500 border-slate-100">Tid</th> <th class="px-6 align-middle border border-solid py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left bg-slate-50 text-slate-500 border-slate-100">Namn</th> <th class="px-6 align-middle border border-solid py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left bg-slate-50 text-slate-500 border-slate-100">Telefonnummer</th> <th class="px-6 align-middle border border-solid py-3 text-xs uppercase border-l-0 border-r-0 whitespace-nowrap font-semibold text-left bg-slate-50 text-slate-500 border-slate-100">Antal</th></tr>',ee,W,Q,ue,ke;i=new be({props:{icon:$e,rotate:180,size:"1.5x"}}),f=new be({props:{icon:$e,size:"1.5x"}}),y=new be({props:{icon:Ze,size:"1.5x",pulse:o[2]}});let A=o[1]&&Le(o);return{c(){t=k("div"),l=k("div"),e=k("div"),r=k("h3"),u=P("Bokningar ("),h=P(m),s=P(")"),d=N(),v=k("button"),ae(i.$$.fragment),c=N(),x=k("h3"),L=P(H),g=N(),M=k("span"),_=P(B),C=N(),T=k("button"),ae(f.$$.fragment),D=N(),a=k("div"),b=N(),E=k("button"),ae(y.$$.fragment),z=N(),G=k("div"),q=k("table"),Y=k("thead"),Y.innerHTML=Z,ee=N(),W=k("tbody"),A&&A.c(),this.h()},l($){t=w($,"DIV",{class:!0});var F=S(t);l=w(F,"DIV",{class:!0});var le=S(l);e=w(le,"DIV",{class:!0});var J=S(e);r=w(J,"H3",{class:!0});var fe=S(r);u=j(fe,"Bokningar ("),h=j(fe,m),s=j(fe,")"),fe.forEach(p),d=O(J),v=w(J,"BUTTON",{class:!0});var Te=S(v);se(i.$$.fragment,Te),Te.forEach(p),c=O(J),x=w(J,"H3",{class:!0});var de=S(x);L=j(de,H),g=O(de),M=w(de,"SPAN",{class:!0});var xe=S(M);_=j(xe,B),xe.forEach(p),de.forEach(p),C=O(J),T=w(J,"BUTTON",{class:!0});var De=S(T);se(f.$$.fragment,De),De.forEach(p),D=O(J),a=w(J,"DIV",{class:!0}),S(a).forEach(p),b=O(J),E=w(J,"BUTTON",{class:!0});var ye=S(E);se(y.$$.fragment,ye),ye.forEach(p),J.forEach(p),le.forEach(p),z=O(F),G=w(F,"DIV",{class:!0});var Ee=S(G);q=w(Ee,"TABLE",{class:!0});var ce=S(q);Y=w(ce,"THEAD",{["data-svelte-h"]:!0}),re(Y)!=="svelte-140iagi"&&(Y.innerHTML=Z),ee=O(ce),W=w(ce,"TBODY",{});var Ie=S(W);A&&A.l(Ie),Ie.forEach(p),ce.forEach(p),Ee.forEach(p),F.forEach(p),this.h()},h(){I(r,"class","mr-4 font-semibold text-lg text-slate-700"),I(v,"class","m-1 text-sky-600 hover:text-sky-900"),I(M,"class","pointer-events-none absolute -top-7 left-0 w-max opacity-0 transition-opacity group-hover:opacity-90 bg-sky-200 rounded-md text-sm"),I(x,"class","font-semibold text-lg text-slate-700 group relative"),I(T,"class","m-1 text-sky-600 hover:text-sky-900"),I(a,"class","flex-grow"),I(E,"class","m-1 text-sky-600 hover:text-sky-900"),I(e,"class","flex flex-wrap flex-row items-center"),I(l,"class","rounded-t mb-0 px-4 py-3 border-0"),I(q,"class","items-center w-full bg-transparent border-collapse"),I(G,"class","block w-full overflow-x-auto"),I(t,"class","relative flex flex-col min-w-0 break-words w-full pb-4 shadow-lg rounded bg-white")},m($,F){R($,t,F),n(t,l),n(l,e),n(e,r),n(r,u),n(r,h),n(r,s),n(e,d),n(e,v),ne(i,v,null),n(e,c),n(e,x),n(x,L),n(x,g),n(x,M),n(M,_),n(e,C),n(e,T),ne(f,T,null),n(e,D),n(e,a),n(e,b),n(e,E),ne(y,E,null),n(t,z),n(t,G),n(G,q),n(q,Y),n(q,ee),n(q,W),A&&A.m(W,null),Q=!0,ue||(ke=[me(v,"click",o[4]),me(T,"click",o[5]),me(E,"click",o[6])],ue=!0)},p($,[F]){var J;(!Q||F&2)&&m!==(m=((J=$[1])==null?void 0:J.length)+"")&&U(h,m),(!Q||F&1)&&H!==(H=`${V.fromJSDate($[0]).toRelativeCalendar()}`)&&U(L,H),(!Q||F&1)&&B!==(B=$[0].toLocaleDateString()+"")&&U(_,B);const le={};F&4&&(le.pulse=$[2]),y.$set(le),$[1]?A?A.p($,F):(A=Le($),A.c(),A.m(W,null)):A&&(A.d(1),A=null)},i($){Q||(K(i.$$.fragment,$),K(f.$$.fragment,$),K(y.$$.fragment,$),Q=!0)},o($){X(i.$$.fragment,$),X(f.$$.fragment,$),X(y.$$.fragment,$),Q=!1},d($){$&&p(t),ie(i),ie(f),ie(y),A&&A.d(),ue=!1,Ve(ke)}}}function tt(o,t,l){let e,{date:r}=t,{bookings:u}=t,m=!1;function h(){r.setDate(r.getDate()-1),l(0,r)}function s(){r.setDate(r.getDate()+1),l(0,r)}function d(){const v=qe()??"";l(2,m=!0),Qe(v,r.toISOString()).then(i=>{l(2,m=!1)})}return o.$$set=v=>{"date"in v&&l(0,r=v.date),"bookings"in v&&l(1,u=v.bookings)},o.$$.update=()=>{o.$$.dirty&2&&l(3,e=u.reduce((v,i)=>(Object.values(i.bookingId.priceObject.products).forEach(c=>{v[c.productName]=(v[c.productName]||0)+c.quantity}),v),{}))},[r,u,m,e,h,s,d]}class lt extends _e{constructor(t){super(),ve(this,t,tt,et,ge,{date:0,bookings:1})}}function rt(o){let t;return{c(){t=k("div")},l(l){t=w(l,"DIV",{}),S(t).forEach(p)},m(l,e){R(l,t,e),o[7](t)},p:oe,i:oe,o:oe,d(l){l&&p(t),o[7](null)}}}function ot(o,t,l){let e,r,u=oe,m=()=>(u(),u=je(s,g=>l(6,r=g)),s);o.$$.on_destroy.push(()=>u());let{date:h}=t,{bookings:s}=t;m();let d,v,i,c,x=[],H=V.now().toMillis();Fe(async()=>{d=(await He(()=>import("../chunks/index.571c4133.js"),[],import.meta.url)).SvelteGantt,v=(await He(()=>import("../chunks/index.571c4133.js"),[],import.meta.url)).SvelteGanttTable;let g={headers:[{unit:"day",format:"dd/MM/yyyy"},{unit:"hour",format:"hh:mm"}],rows:[],tasks:[],timeRanges:[{id:0,from:H,to:H+6e4,label:"Nu",enableResizing:!1}],columnUnit:"hour",columnOffset:1,magnetOffset:0,rowHeight:50,rowPadding:6,fitWidth:!0,minWidth:2500,from:V.fromJSDate(h).startOf("day").toMillis(),to:V.fromJSDate(h).endOf("day").toMillis(),tableWidth:75,tableHeaders:[{title:"",property:"label",width:100,type:"tree"}],ganttTableModules:[v]};l(3,i=new d({target:c,props:g}));const M=qe()??"",B=await Xe(M);l(4,x=B.map(_=>({id:Number(_.slot),enableDragging:!1,label:`Slot ${_.slot}`,height:50,expanded:!1}))),setTimeout(()=>{const _=document.getElementsByClassName("sg-timeline-body")[0],C=document.getElementsByClassName("sg-time-range")[0];if(!C||!_)return;const T=C.getBoundingClientRect().left,f=_.scrollLeft,a=_.clientWidth/2+75,b=T-a;_.scrollTo({behavior:"smooth",left:b+f})},300)});function L(g){pe[g?"unshift":"push"](()=>{c=g,l(1,c)})}return o.$$set=g=>{"date"in g&&l(2,h=g.date),"bookings"in g&&m(l(0,s=g.bookings))},o.$$.update=()=>{o.$$.dirty&64&&l(5,e=r==null?void 0:r.map((g,M)=>({id:M,amountDone:Ye(H,g.startTime.getTime(),g.endTime.getTime()),from:g.startTime,to:g.endTime,label:`${g.bookingId.customerInfo.firstName} ${g.bookingId.customerInfo.lastName}`,showButton:!1,enableDragging:!1,resourceId:Number(g.productSlotId.slot)}))),o.$$.dirty&60&&i&&x&&e&&i.$set({rows:x,tasks:e,from:V.fromJSDate(h).startOf("day").toMillis(),to:V.fromJSDate(h).endOf("day").toMillis()})},[s,c,h,i,x,e,r,L]}class at extends _e{constructor(t){super(),ve(this,t,ot,rt,ge,{date:2,bookings:0})}}function Pe(o){let t,l,e,r,u,m;function h(i){o[5](i)}let s={bookings:o[3]};o[0]!==void 0&&(s.date=o[0]),t=new at({props:s}),pe.push(()=>Oe(t,"date",h));function d(i){o[6](i)}let v={bookings:o[2]};return o[0]!==void 0&&(v.date=o[0]),r=new lt({props:v}),pe.push(()=>Oe(r,"date",d)),{c(){ae(t.$$.fragment),e=N(),ae(r.$$.fragment)},l(i){se(t.$$.fragment,i),e=O(i),se(r.$$.fragment,i)},m(i,c){ne(t,i,c),R(i,e,c),ne(r,i,c),m=!0},p(i,c){const x={};c&8&&(x.bookings=i[3]),!l&&c&1&&(l=!0,x.date=i[0],Se(()=>l=!1)),t.$set(x);const H={};c&4&&(H.bookings=i[2]),!u&&c&1&&(u=!0,H.date=i[0],Se(()=>u=!1)),r.$set(H)},i(i){m||(K(t.$$.fragment,i),K(r.$$.fragment,i),m=!0)},o(i){X(t.$$.fragment,i),X(r.$$.fragment,i),m=!1},d(i){i&&p(e),ie(t,i),ie(r,i)}}}function st(o){let t,l,e=o[1]&&Pe(o);return{c(){e&&e.c(),t=Ne()},l(r){e&&e.l(r),t=Ne()},m(r,u){e&&e.m(r,u),R(r,t,u),l=!0},p(r,[u]){r[1]?e?(e.p(r,u),u&2&&K(e,1)):(e=Pe(r),e.c(),K(e,1),e.m(t.parentNode,t)):e&&(We(),X(e,1,1,()=>{e=null}),Ue())},i(r){l||(K(e),l=!0)},o(r){X(e),l=!1},d(r){r&&p(t),e&&e.d(r)}}}function nt(o,t,l){let e,r,u,m,h=oe,s=()=>(h(),h=je(r,c=>l(1,m=c)),r);o.$$.on_destroy.push(()=>h());let d=V.now().startOf("day").toJSDate();function v(c){d=c,l(0,d)}function i(c){d=c,l(0,d)}return o.$$.update=()=>{o.$$.dirty&1&&l(4,e=V.fromJSDate(d).endOf("day").toJSDate()),o.$$.dirty&17&&s(l(3,r=ze(async()=>Ge.bookings.where("startTime").aboveOrEqual(d).and(c=>c.startTime<=e).toArray()))),o.$$.dirty&2&&l(2,u=m!=null?Ke(m):[])},[d,m,u,r,e,v,i]}class _t extends _e{constructor(t){super(),ve(this,t,nt,st,ge,{})}}export{_t as component};
